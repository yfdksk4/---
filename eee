print("ğŸ® =================================")
print("ğŸ® eeeè…³æœ¬ - æ”»æ“Šç©å®¶èˆ‡NPCç‰ˆ")
print("ğŸ® eeeå‰µä½œ")
print("ğŸ® =================================")

-- æª¢æ¸¬è¨­å‚™é¡å‹
local inputService = game:GetService("UserInputService")
local isMobile = inputService.TouchEnabled
local isDesktop = inputService.MouseEnabled
local deviceType = isMobile and "ğŸ“± æ‰‹æ©Ÿ" or "ğŸ–¥ï¸ é›»è…¦"
print("âœ… æª¢æ¸¬åˆ°è¨­å‚™: " .. deviceType)

-- ç¢ºä¿éŠæˆ²å®Œå…¨åŠ è¼‰
repeat task.wait() until game:IsLoaded()
print("âœ… éŠæˆ²å·²åŠ è¼‰")

-- ç²å–ç©å®¶
local player = game.Players.LocalPlayer
if not player then
    warn("âŒ ç„¡æ³•ç²å–ç©å®¶")
    return
end
print("âœ… ç©å®¶: " .. player.Name)

-- ç­‰å¾…PlayerGui
local playerGui = player:WaitForChild("PlayerGui", 10)
if not playerGui then
    warn("âŒ ç„¡æ³•æ‰¾åˆ°PlayerGuiï¼Œå˜—è©¦ä½¿ç”¨CoreGui")
    playerGui = game:GetService("CoreGui")
end
print("âœ… UIå®¹å™¨: " .. playerGui.Name)

-- æ¸…ç†èˆŠçš„UI
for _, gui in ipairs(playerGui:GetChildren()) do
    if gui.Name:find("Eee") or gui.Name:find("XuanCong") then
        gui:Destroy()
    end
end
print("ğŸ—‘ï¸ æ¸…ç†äº†èˆŠçš„UI")

-- ========================
-- å…¨å±€æœå‹™
-- ========================
local tweenService = game:GetService("TweenService")
local runService = game:GetService("RunService")
local httpService = game:GetService("HttpService")
local playersService = game:GetService("Players")

print("âœ… æœå‹™åŠ è¼‰å®Œæˆ")

-- ========================
-- å‰µå»ºä¸»UI ScreenGui
-- ========================
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "EeeScript_Fixed"
screenGui.Parent = playerGui
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
screenGui.DisplayOrder = 999
screenGui.IgnoreGuiInset = false

print("âœ… ScreenGuiå‰µå»ºå®Œæˆ")

-- ========================
-- å‰µå»ºä¸»æ¡†æ¶
-- ========================
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 220, 0, 180) -- å¢åŠ é«˜åº¦ä»¥å®¹ç´æ›´å¤šæŒ‰éˆ•
mainFrame.Position = UDim2.new(0.5, -110, 0.5, -90)
mainFrame.BackgroundColor3 = Color3.fromRGB(25, 35, 50)
mainFrame.BackgroundTransparency = 0.1
mainFrame.BorderSizePixel = 0
mainFrame.Visible = true
mainFrame.Active = true
mainFrame.Parent = screenGui

-- åœ“è§’
local uiCorner = Instance.new("UICorner")
uiCorner.CornerRadius = UDim.new(0, 6)
uiCorner.Parent = mainFrame

-- é‚Šæ¡†
local uiStroke = Instance.new("UIStroke")
uiStroke.Color = Color3.fromRGB(100, 150, 200)
uiStroke.Thickness = 1
uiStroke.Parent = mainFrame

print("âœ… ä¸»æ¡†æ¶å‰µå»ºå®Œæˆ")

-- ========================
-- æ‹–å‹•ç³»çµ±ï¼ˆä¿®å¾©ç‰ˆï¼‰
-- ========================
print("ğŸ”„ è¨­ç½®æ‹–å‹•ç³»çµ±...")

-- å‰µå»ºæ‹–å‹•æ¨™é¡Œæ¬„
local dragButton = Instance.new("TextButton")
dragButton.Name = "DragButton"
dragButton.Size = UDim2.new(1, 0, 0, 30)
dragButton.Position = UDim2.new(0, 0, 0, 0)
dragButton.BackgroundColor3 = Color3.fromRGB(40, 60, 90)
dragButton.BackgroundTransparency = 0.2
dragButton.BorderSizePixel = 0
dragButton.Text = "ğŸ® eeeè…³æœ¬ (æ‹–å‹•æˆ‘)"
dragButton.TextColor3 = Color3.fromRGB(200, 230, 255)
dragButton.Font = Enum.Font.GothamBold
dragButton.TextSize = 12
dragButton.AutoButtonColor = false
dragButton.Parent = mainFrame

local dragCorner = Instance.new("UICorner")
dragCorner.CornerRadius = UDim.new(0, 6, 0, 0)
dragCorner.Parent = dragButton

-- å³ä¸Šè§’é—œé–‰æŒ‰éˆ•
local closeButton = Instance.new("TextButton")
closeButton.Name = "CloseButton"
closeButton.Size = UDim2.new(0, 24, 0, 24)
closeButton.Position = UDim2.new(1, -28, 0, 3)
closeButton.BackgroundColor3 = Color3.fromRGB(220, 100, 100)
closeButton.BackgroundTransparency = 0.2
closeButton.BorderSizePixel = 0
closeButton.Text = "âœ•"
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.Font = Enum.Font.GothamBold
closeButton.TextSize = 12
closeButton.AutoButtonColor = true
closeButton.ZIndex = 2
closeButton.Parent = dragButton

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0, 4)
closeCorner.Parent = closeButton

-- æ‹–å‹•è®Šé‡
local isDragging = false
local dragStartPosition = Vector2.new(0, 0)
local frameStartPosition = UDim2.new(0, 0, 0, 0)

-- é›»è…¦æ‹–å‹•
dragButton.MouseButton1Down:Connect(function()
    isDragging = true
    dragStartPosition = inputService:GetMouseLocation()
    frameStartPosition = mainFrame.Position
    dragButton.BackgroundColor3 = Color3.fromRGB(60, 90, 140)
end)

inputService.InputChanged:Connect(function(input)
    if isDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local currentMouse = inputService:GetMouseLocation()
        local delta = currentMouse - dragStartPosition
        
        mainFrame.Position = UDim2.new(
            frameStartPosition.X.Scale,
            frameStartPosition.X.Offset + delta.X,
            frameStartPosition.Y.Scale,
            frameStartPosition.Y.Offset + delta.Y
        )
    end
end)

inputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        if isDragging then
            isDragging = false
            dragButton.BackgroundColor3 = Color3.fromRGB(40, 60, 90)
        end
    end
end)

-- æ‰‹æ©Ÿæ‹–å‹•
if isMobile then
    print("ğŸ“± è¨­ç½®æ‰‹æ©Ÿæ‹–å‹•ç³»çµ±...")
    
    local touchArea = Instance.new("TextButton")
    touchArea.Name = "TouchArea"
    touchArea.Size = UDim2.new(1, 20, 1, 20)
    touchArea.Position = UDim2.new(0, -10, 0, -10)
    touchArea.BackgroundTransparency = 1
    touchArea.Text = ""
    touchArea.ZIndex = -1
    touchArea.Parent = dragButton
    
    local touchStartPosition = Vector2.new(0, 0)
    local touchFrameStart = UDim2.new(0, 0, 0, 0)
    local touchDragging = false
    
    -- è§¸æ§é–‹å§‹
    touchArea.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            touchDragging = true
            touchStartPosition = input.Position
            touchFrameStart = mainFrame.Position
            dragButton.BackgroundColor3 = Color3.fromRGB(60, 90, 140)
        end
    end)
    
    -- è§¸æ§ç§»å‹•
    inputService.InputChanged:Connect(function(input)
        if touchDragging and input.UserInputType == Enum.UserInputType.Touch then
            local currentTouch = input.Position
            local delta = currentTouch - touchStartPosition
            
            mainFrame.Position = UDim2.new(
                touchFrameStart.X.Scale,
                touchFrameStart.X.Offset + delta.X,
                touchFrameStart.Y.Scale,
                touchFrameStart.Y.Offset + delta.Y
            )
        end
    end)
    
    -- è§¸æ§çµæŸ
    inputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            if touchDragging then
                touchDragging = false
                dragButton.BackgroundColor3 = Color3.fromRGB(40, 60, 90)
            end
        end
    end)
end

print("âœ… æ‹–å‹•ç³»çµ±å·²è¨­ç½®")

-- ========================
-- å‰µå»ºåŠŸèƒ½æŒ‰éˆ•ï¼ˆä¿®å¾©ç‰ˆï¼‰
-- ========================
local function createButton(text, icon, yPos, color)
    local button = Instance.new("TextButton")
    button.Name = text
    button.Size = UDim2.new(1, -16, 0, 28)
    button.Position = UDim2.new(0, 8, 0, yPos)
    button.BackgroundColor3 = color
    button.BackgroundTransparency = 0.3
    button.BorderSizePixel = 0
    button.Text = icon .. " " .. text
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.Font = Enum.Font.Gotham
    button.TextSize = 12
    button.AutoButtonColor = true
    button.Active = true
    button.Parent = mainFrame
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 5)
    corner.Parent = button
    
    return button
end

-- å‰µå»ºæŒ‰éˆ•ï¼ˆèª¿æ•´ä½ç½®ï¼‰
local attackPlayersBtn = createButton("æ”»æ“Šç©å®¶", "âš¡", 36, Color3.fromRGB(0, 150, 220))
local attackNPCBtn = createButton("æ”»æ“ŠNPC", "ğŸ‘¹", 70, Color3.fromRGB(180, 70, 200))
local piScriptBtn = createButton("çš®è…³æœ¬", "ğŸ…¿ï¸", 104, Color3.fromRGB(220, 150, 50))

print("âœ… åŠŸèƒ½æŒ‰éˆ•å‰µå»ºå®Œæˆ")

-- ========================
-- æ·»åŠ ä½œè€…ä¿¡æ¯
-- ========================
local authorLabel = Instance.new("TextLabel")
authorLabel.Name = "AuthorLabel"
authorLabel.Size = UDim2.new(1, -16, 0, 16)
authorLabel.Position = UDim2.new(0, 8, 0, 152)
authorLabel.BackgroundTransparency = 1
authorLabel.Text = "ğŸ‘‘ eeeå‰µä½œ"
authorLabel.TextColor3 = Color3.fromRGB(180, 180, 220)
authorLabel.Font = Enum.Font.Gotham
authorLabel.TextSize = 9
authorLabel.TextXAlignment = Enum.TextXAlignment.Center
authorLabel.Parent = mainFrame

local versionLabel = Instance.new("TextLabel")
versionLabel.Name = "VersionLabel"
versionLabel.Size = UDim2.new(1, -16, 0, 12)
versionLabel.Position = UDim2.new(0, 8, 0, 168)
versionLabel.BackgroundTransparency = 1
versionLabel.Text = "ğŸ® eeeè…³æœ¬ v3.1"
versionLabel.TextColor3 = Color3.fromRGB(150, 200, 255)
versionLabel.Font = Enum.Font.Gotham
versionLabel.TextSize = 8
versionLabel.TextXAlignment = Enum.TextXAlignment.Center
versionLabel.Parent = mainFrame

-- ========================
-- å³ä¸‹è§’é€šçŸ¥ç³»çµ±
-- ========================
local function showNotification(message, color, duration)
    duration = duration or 2.5
    
    local notifyFrame = Instance.new("Frame")
    notifyFrame.Name = "Notify_" .. tick()
    notifyFrame.Size = UDim2.new(0, 200, 0, 60)
    notifyFrame.Position = UDim2.new(1, 210, 1, -70)
    notifyFrame.AnchorPoint = Vector2.new(1, 1)
    notifyFrame.BackgroundColor3 = color or Color3.fromRGB(40, 60, 90)
    notifyFrame.BackgroundTransparency = 0.2
    notifyFrame.BorderSizePixel = 0
    notifyFrame.ZIndex = 10000
    notifyFrame.Parent = screenGui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = notifyFrame
    
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(150, 200, 255)
    stroke.Thickness = 1
    stroke.Transparency = 0.3
    stroke.Parent = notifyFrame
    
    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(1, -16, 1, -16)
    textLabel.Position = UDim2.new(0, 8, 0, 8)
    textLabel.BackgroundTransparency = 1
    textLabel.Text = message
    textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    textLabel.Font = Enum.Font.Gotham
    textLabel.TextSize = 11
    textLabel.TextWrapped = true
    textLabel.Parent = notifyFrame
    
    print("ğŸ“¢ é€šçŸ¥: " .. message)
    
    local slideIn = tweenService:Create(notifyFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Position = UDim2.new(1, -10, 1, -70)
    })
    slideIn:Play()
    
    task.spawn(function()
        task.wait(duration)
        
        if notifyFrame and notifyFrame.Parent then
            local slideOut = tweenService:Create(notifyFrame, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
                Position = UDim2.new(1, 210, 1, -70)
            })
            slideOut:Play()
            
            slideOut.Completed:Wait()
            notifyFrame:Destroy()
        end
    end)
    
    return notifyFrame
end

-- ========================
-- æ”»æ“Šç©å®¶ç³»çµ±ï¼ˆä¸ç§»å‹•ä½ç½®ç‰ˆæœ¬ï¼‰
-- ========================
print("âš¡ åˆå§‹åŒ–æ”»æ“Šç©å®¶ç³»çµ±...")

local isAttackPlayersOn = false
local attackPlayersConnection = nil

-- æ”»æ“Šç©å®¶åŠŸèƒ½
local function setupAttackPlayers()
    showNotification("âš¡ æ­£åœ¨åˆå§‹åŒ–æ”»æ“Šç©å®¶...", Color3.fromRGB(255, 165, 0), 1)
    
    -- å˜—è©¦åŠ è¼‰æ”»æ“Šç©å®¶æ¨¡å¡Š
    local success, result = pcall(function()
        -- è¨­ç½®å…¨å±€è®Šé‡
        _G.AttackPlayers = true
        
        -- ç²å–æœ¬åœ°ç©å®¶
        local Player = playersService.LocalPlayer
        
        if not Player then
            return nil, "æ‰¾ä¸åˆ°ç©å®¶"
        end
        
        -- æ”»æ“Šç©å®¶åŠŸèƒ½ï¼ˆä¸ç§»å‹•ä½ç½®ç‰ˆæœ¬ï¼‰
        local function attackOtherPlayers()
            local character = Player.Character
            if not character then return end
            
            local humanoid = character:FindFirstChild("Humanoid")
            local rootPart = character:FindFirstChild("HumanoidRootPart")
            
            if not humanoid or humanoid.Health <= 0 or not rootPart then return end
            
            -- æ‰¾åˆ°æœ€è¿‘çš„ç©å®¶ï¼ˆä¸åŒ…æ‹¬è‡ªå·±ï¼‰
            local closestPlayer = nil
            local closestDistance = 6000 -- æ”»æ“Šç¯„åœ
            local closestPlayerName = ""
            
            -- æª¢æŸ¥æ‰€æœ‰ç©å®¶
            for _, otherPlayer in ipairs(playersService:GetPlayers()) do
                if otherPlayer ~= Player and otherPlayer.Character then
                    local otherCharacter = otherPlayer.Character
                    local otherHumanoid = otherCharacter:FindFirstChild("Humanoid")
                    local otherRootPart = otherCharacter:FindFirstChild("HumanoidRootPart")
                    
                    if otherHumanoid and otherHumanoid.Health > 0 and otherRootPart then
                        local distance = (rootPart.Position - otherRootPart.Position).Magnitude
                        if distance < closestDistance then
                            closestDistance = distance
                            closestPlayer = otherCharacter
                            closestPlayerName = otherPlayer.Name
                        end
                    end
                end
            end
            
            -- å¦‚æœæœ‰å…¶ä»–ç©å®¶ï¼ŒåŸ·è¡Œæ”»æ“Š
            if closestPlayer then
                print("âš”ï¸ æ”»æ“Šç©å®¶: " .. closestPlayerName .. " è·é›¢: " .. math.floor(closestDistance) .. " å–®ä½")
                
                -- å˜—è©¦è§¸ç™¼æ”»æ“Šäº‹ä»¶
                pcall(function()
                    -- å˜—è©¦æ‰¾åˆ°éŠæˆ²çš„æ”»æ“Šç³»çµ±
                    local ReplicatedStorage = game:GetService("ReplicatedStorage")
                    
                    if ReplicatedStorage then
                        local Remotes = ReplicatedStorage:FindFirstChild("Remotes")
                        local Modules = ReplicatedStorage:FindFirstChild("Modules")
                        
                        if Modules then
                            local Net = Modules:FindFirstChild("Net")
                            if Net then
                                -- å˜—è©¦å„ç¨®å¯èƒ½çš„æ”»æ“Šäº‹ä»¶åç¨±
                                local attackNames = {
                                    "RE/RegisterAttack",
                                    "RegisterAttack",
                                    "Attack",
                                    "DoAttack",
                                    "FireAttack"
                                }
                                
                                local hitNames = {
                                    "RE/RegisterHit",
                                    "RegisterHit",
                                    "Hit",
                                    "DoHit",
                                    "Damage"
                                }
                                
                                -- å˜—è©¦æ”»æ“Šäº‹ä»¶
                                for _, attackName in ipairs(attackNames) do
                                    local attackEvent = Net:FindFirstChild(attackName)
                                    if attackEvent then
                                        pcall(function() attackEvent:FireServer() end)
                                        break
                                    end
                                end
                                
                                -- å˜—è©¦å‘½ä¸­äº‹ä»¶
                                for _, hitName in ipairs(hitNames) do
                                    local hitEvent = Net:FindFirstChild(hitName)
                                    if hitEvent and closestPlayer:FindFirstChild("Head") then
                                        pcall(function() hitEvent:FireServer(closestPlayer.Head, {closestPlayer}) end)
                                        break
                                    end
                                end
                            end
                        end
                        
                        -- å˜—è©¦ç›´æ¥ä½¿ç”¨Remotes
                        if Remotes then
                            local attackRemote = Remotes:FindFirstChild("Attack")
                            if attackRemote then
                                pcall(function() attackRemote:FireServer() end)
                            end
                        end
                    end
                end)
            end
        end
        
        return {
            start = function()
                print("â–¶ï¸ é–‹å§‹æ”»æ“Šç©å®¶ (ç¯„åœ: 6000, ä¸ç§»å‹•ä½ç½®)")
                attackPlayersConnection = runService.Heartbeat:Connect(function()
                    attackOtherPlayers()
                end)
            end,
            stop = function()
                print("â¹ï¸ åœæ­¢æ”»æ“Šç©å®¶")
                if attackPlayersConnection then
                    attackPlayersConnection:Disconnect()
                    attackPlayersConnection = nil
                end
            end,
            attackOtherPlayers = attackOtherPlayers
        }
    end)
    
    if success and result then
        showNotification("âœ… æ”»æ“Šç©å®¶åˆå§‹åŒ–å®Œæˆ\nç¯„åœ: 6000 å–®ä½\nç›®æ¨™: å…¶ä»–ç©å®¶\nä¸ç§»å‹•ä½ç½®", Color3.fromRGB(0, 180, 0), 1.5)
        return result
    else
        local errMsg = result or "æœªçŸ¥éŒ¯èª¤"
        showNotification("âš ï¸ æ”»æ“Šç©å®¶åˆå§‹åŒ–å¤±æ•—: " .. errMsg, Color3.fromRGB(255, 0, 0), 2)
        print("âŒ æ”»æ“Šç©å®¶åˆå§‹åŒ–å¤±æ•—: " .. errMsg)
        return nil
    end
end

-- åˆå§‹åŒ–æ”»æ“Šç©å®¶
local attackPlayersModule = setupAttackPlayers()

-- ========================
-- æ”»æ“ŠNPCç³»çµ±ï¼ˆæ–°å¢åŠ ï¼‰
-- ========================
print("ğŸ‘¹ åˆå§‹åŒ–æ”»æ“ŠNPCç³»çµ±...")

local isAttackNPCOn = false
local attackNPCConnection = nil

-- æ”»æ“ŠNPCåŠŸèƒ½
local function setupAttackNPC()
    showNotification("ğŸ‘¹ æ­£åœ¨åˆå§‹åŒ–æ”»æ“ŠNPC...", Color3.fromRGB(255, 165, 0), 1)
    
    -- å˜—è©¦åŠ è¼‰æ”»æ“ŠNPCæ¨¡å¡Š
    local success, result = pcall(function()
        -- è¨­ç½®å…¨å±€è®Šé‡
        _G.AttackNPC = true
        
        -- ç²å–æœ¬åœ°ç©å®¶
        local Player = playersService.LocalPlayer
        
        if not Player then
            return nil, "æ‰¾ä¸åˆ°ç©å®¶"
        end
        
        -- æ”»æ“ŠNPCåŠŸèƒ½ï¼ˆä¸ç§»å‹•ä½ç½®ç‰ˆæœ¬ï¼‰
        local function attackNPC()
            local character = Player.Character
            if not character then return end
            
            local humanoid = character:FindFirstChild("Humanoid")
            local rootPart = character:FindFirstChild("HumanoidRootPart")
            
            if not humanoid or humanoid.Health <= 0 or not rootPart then return end
            
            -- æ‰¾åˆ°æœ€è¿‘çš„NPC
            local closestNPC = nil
            local closestDistance = 6000 -- æ”»æ“Šç¯„åœ
            local closestNPCName = ""
            
            -- æª¢æŸ¥workspaceä¸­çš„NPC
            -- å¸¸è¦‹çš„NPCå¯èƒ½åœ¨ä¸åŒæ–‡ä»¶å¤¾ä¸­
            local npcFolders = {
                workspace:FindFirstChild("Enemies"),
                workspace:FindFirstChild("NPCs"),
                workspace:FindFirstChild("Mobs"),
                workspace:FindFirstChild("Monsters"),
                workspace:FindFirstChild("Characters")
            }
            
            for _, npcFolder in ipairs(npcFolders) do
                if npcFolder and npcFolder:IsA("Folder") then
                    for _, npc in ipairs(npcFolder:GetChildren()) do
                        -- æª¢æŸ¥æ˜¯å¦æ˜¯NPCï¼ˆæœ‰Humanoidå’ŒHumanoidRootPartï¼‰
                        local npcHumanoid = npc:FindFirstChild("Humanoid")
                        local npcRootPart = npc:FindFirstChild("HumanoidRootPart")
                        
                        if npcHumanoid and npcHumanoid.Health > 0 and npcRootPart then
                            local distance = (rootPart.Position - npcRootPart.Position).Magnitude
                            if distance < closestDistance then
                                closestDistance = distance
                                closestNPC = npc
                                closestNPCName = npc.Name
                            end
                        end
                    end
                end
            end
            
            -- å¦‚æœæ‰¾ä¸åˆ°ç‰¹å®šæ–‡ä»¶å¤¾ä¸­çš„NPCï¼Œæª¢æŸ¥workspaceä¸­æ‰€æœ‰æœ‰Humanoidçš„æ¨¡å‹
            if not closestNPC then
                for _, model in ipairs(workspace:GetChildren()) do
                    if model:IsA("Model") and not model:FindFirstChildOfClass("Player") then
                        local npcHumanoid = model:FindFirstChild("Humanoid")
                        local npcRootPart = model:FindFirstChild("HumanoidRootPart")
                        
                        if npcHumanoid and npcHumanoid.Health > 0 and npcRootPart then
                            -- æ’é™¤ç©å®¶è§’è‰²
                            local isPlayer = false
                            for _, player in ipairs(playersService:GetPlayers()) do
                                if player.Character == model then
                                    isPlayer = true
                                    break
                                end
                            end
                            
                            if not isPlayer then
                                local distance = (rootPart.Position - npcRootPart.Position).Magnitude
                                if distance < closestDistance then
                                    closestDistance = distance
                                    closestNPC = model
                                    closestNPCName = model.Name
                                end
                            end
                        end
                    end
                end
            end
            
            -- å¦‚æœæœ‰NPCï¼ŒåŸ·è¡Œæ”»æ“Š
            if closestNPC then
                print("ğŸ‘¹ æ”»æ“ŠNPC: " .. closestNPCName .. " è·é›¢: " .. math.floor(closestDistance) .. " å–®ä½")
                
                -- å˜—è©¦è§¸ç™¼æ”»æ“Šäº‹ä»¶
                pcall(function()
                    -- å˜—è©¦æ‰¾åˆ°éŠæˆ²çš„æ”»æ“Šç³»çµ±
                    local ReplicatedStorage = game:GetService("ReplicatedStorage")
                    
                    if ReplicatedStorage then
                        local Remotes = ReplicatedStorage:FindFirstChild("Remotes")
                        local Modules = ReplicatedStorage:FindFirstChild("Modules")
                        
                        if Modules then
                            local Net = Modules:FindFirstChild("Net")
                            if Net then
                                -- å˜—è©¦å„ç¨®å¯èƒ½çš„æ”»æ“Šäº‹ä»¶åç¨±
                                local attackNames = {
                                    "RE/RegisterAttack",
                                    "RegisterAttack",
                                    "Attack",
                                    "DoAttack",
                                    "FireAttack"
                                }
                                
                                local hitNames = {
                                    "RE/RegisterHit",
                                    "RegisterHit",
                                    "Hit",
                                    "DoHit",
                                    "Damage"
                                }
                                
                                -- å˜—è©¦æ”»æ“Šäº‹ä»¶
                                for _, attackName in ipairs(attackNames) do
                                    local attackEvent = Net:FindFirstChild(attackName)
                                    if attackEvent then
                                        pcall(function() attackEvent:FireServer() end)
                                        break
                                    end
                                end
                                
                                -- å˜—è©¦å‘½ä¸­äº‹ä»¶
                                for _, hitName in ipairs(hitNames) do
                                    local hitEvent = Net:FindFirstChild(hitName)
                                    if hitEvent and closestNPC:FindFirstChild("Head") then
                                        pcall(function() hitEvent:FireServer(closestNPC.Head, {closestNPC}) end)
                                        break
                                    end
                                end
                            end
                        end
                        
                        -- å˜—è©¦ç›´æ¥ä½¿ç”¨Remotes
                        if Remotes then
                            local attackRemote = Remotes:FindFirstChild("Attack")
                            if attackRemote then
                                pcall(function() attackRemote:FireServer() end)
                            end
                        end
                    end
                end)
            end
        end
        
        return {
            start = function()
                print("â–¶ï¸ é–‹å§‹æ”»æ“ŠNPC (ç¯„åœ: 6000, ä¸ç§»å‹•ä½ç½®)")
                attackNPCConnection = runService.Heartbeat:Connect(function()
                    attackNPC()
                end)
            end,
            stop = function()
                print("â¹ï¸ åœæ­¢æ”»æ“ŠNPC")
                if attackNPCConnection then
                    attackNPCConnection:Disconnect()
                    attackNPCConnection = nil
                end
            end,
            attackNPC = attackNPC
        }
    end)
    
    if success and result then
        showNotification("âœ… æ”»æ“ŠNPCåˆå§‹åŒ–å®Œæˆ\nç¯„åœ: 6000 å–®ä½\nç›®æ¨™: NPC/æ•µäºº\nä¸ç§»å‹•ä½ç½®", Color3.fromRGB(0, 180, 0), 1.5)
        return result
    else
        local errMsg = result or "æœªçŸ¥éŒ¯èª¤"
        showNotification("âš ï¸ æ”»æ“ŠNPCåˆå§‹åŒ–å¤±æ•—: " .. errMsg, Color3.fromRGB(255, 0, 0), 2)
        print("âŒ æ”»æ“ŠNPCåˆå§‹åŒ–å¤±æ•—: " .. errMsg)
        return nil
    end
end

-- åˆå§‹åŒ–æ”»æ“ŠNPC
local attackNPCModule = setupAttackNPC()

-- ========================
-- çš®è…³æœ¬åŠŸèƒ½ï¼ˆä¿æŒä¸è®Šï¼‰
-- ========================
local function executePiScript()
    showNotification("ğŸ…¿ï¸ æ­£åœ¨åŠ è¼‰çš®è…³æœ¬...", Color3.fromRGB(255, 165, 0), 2)
    
    -- å˜—è©¦åŠ è¼‰çš®è…³æœ¬
    local success, err = pcall(function()
        -- ä½¿ç”¨å®‰å…¨çš„åŠ è¼‰æ–¹å¼
        local scriptUrl = "https://raw.githubusercontent.com/xiaopi77/xiaopi77/main/QQ1002100032-Roblox-Pi-script.lua"
        
        -- å˜—è©¦ç²å–è…³æœ¬
        local response = httpService:GetAsync(scriptUrl, true)
        if response then
            -- åŸ·è¡Œè…³æœ¬
            loadstring(response)()
            return true
        else
            return false, "ç„¡æ³•ç²å–è…³æœ¬"
        end
    end)
    
    if success then
        showNotification("âœ… çš®è…³æœ¬åŠ è¼‰æˆåŠŸ", Color3.fromRGB(0, 180, 0), 2)
        return true
    else
        local errMsg = err or "æœªçŸ¥éŒ¯èª¤"
        showNotification("âŒ çš®è…³æœ¬åŠ è¼‰å¤±æ•—\n" .. errMsg, Color3.fromRGB(255, 0, 0), 2.5)
        print("âŒ çš®è…³æœ¬éŒ¯èª¤: " .. errMsg)
        return false
    end
end

-- ========================
-- æŒ‰éˆ•äº‹ä»¶ï¼ˆä¿®æ”¹ç‰ˆï¼‰
-- ========================
print("ğŸ”§ è¨­ç½®æŒ‰éˆ•äº‹ä»¶...")

-- æ”»æ“Šç©å®¶æŒ‰éˆ•
attackPlayersBtn.MouseButton1Click:Connect(function()
    print("ğŸ”˜ æ”»æ“Šç©å®¶æŒ‰éˆ•è¢«é»æ“Š")
    
    if not attackPlayersModule then
        showNotification("ğŸ”„ æ­£åœ¨é‡æ–°åˆå§‹åŒ–æ”»æ“Šç©å®¶...", Color3.fromRGB(255, 165, 0), 1)
        attackPlayersModule = setupAttackPlayers()
        if not attackPlayersModule then
            return
        end
    end
    
    isAttackPlayersOn = not isAttackPlayersOn
    
    if isAttackPlayersOn then
        -- é–‹å•Ÿæ”»æ“Šç©å®¶
        attackPlayersBtn.BackgroundColor3 = Color3.fromRGB(60, 220, 60)
        attackPlayersBtn.Text = "âš¡ æ”»æ“Šç©å®¶ [ON]"
        showNotification("âš¡ æ”»æ“Šç©å®¶å·²é–‹å•Ÿ\næ”»æ“Šç¯„åœ: 6000 å–®ä½\nç›®æ¨™: å…¶ä»–ç©å®¶\nä¸ç§»å‹•ä½ç½®", Color3.fromRGB(0, 180, 0), 1.5)
        
        if attackPlayersModule and attackPlayersModule.start then
            attackPlayersModule.start()
        end
    else
        -- é—œé–‰æ”»æ“Šç©å®¶
        attackPlayersBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 220)
        attackPlayersBtn.Text = "âš¡ æ”»æ“Šç©å®¶ [OFF]"
        showNotification("ğŸ›‘ æ”»æ“Šç©å®¶å·²é—œé–‰", Color3.fromRGB(200, 0, 0), 1.5)
        
        if attackPlayersModule and attackPlayersModule.stop then
            attackPlayersModule.stop()
        end
    end
end)

-- æ”»æ“ŠNPCæŒ‰éˆ•ï¼ˆæ–°å¢åŠ ï¼‰
attackNPCBtn.MouseButton1Click:Connect(function()
    print("ğŸ”˜ æ”»æ“ŠNPCæŒ‰éˆ•è¢«é»æ“Š")
    
    if not attackNPCModule then
        showNotification("ğŸ”„ æ­£åœ¨é‡æ–°åˆå§‹åŒ–æ”»æ“ŠNPC...", Color3.fromRGB(255, 165, 0), 1)
        attackNPCModule = setupAttackNPC()
        if not attackNPCModule then
            return
        end
    end
    
    isAttackNPCOn = not isAttackNPCOn
    
    if isAttackNPCOn then
        -- é–‹å•Ÿæ”»æ“ŠNPC
        attackNPCBtn.BackgroundColor3 = Color3.fromRGB(60, 220, 60)
        attackNPCBtn.Text = "ğŸ‘¹ æ”»æ“ŠNPC [ON]"
        showNotification("ğŸ‘¹ æ”»æ“ŠNPCå·²é–‹å•Ÿ\næ”»æ“Šç¯„åœ: 6000 å–®ä½\nç›®æ¨™: NPC/æ•µäºº\nä¸ç§»å‹•ä½ç½®", Color3.fromRGB(0, 180, 0), 1.5)
        
        if attackNPCModule and attackNPCModule.start then
            attackNPCModule.start()
        end
    else
        -- é—œé–‰æ”»æ“ŠNPC
        attackNPCBtn.BackgroundColor3 = Color3.fromRGB(180, 70, 200)
        attackNPCBtn.Text = "ğŸ‘¹ æ”»æ“ŠNPC [OFF]"
        showNotification("ğŸ›‘ æ”»æ“ŠNPCå·²é—œé–‰", Color3.fromRGB(200, 0, 0), 1.5)
        
        if attackNPCModule and attackNPCModule.stop then
            attackNPCModule.stop()
        end
    end
end)

-- çš®è…³æœ¬æŒ‰éˆ•ï¼ˆä¿æŒä¸è®Šï¼‰
piScriptBtn.MouseButton1Click:Connect(function()
    print("ğŸ”˜ çš®è…³æœ¬æŒ‰éˆ•è¢«é»æ“Š")
    
    -- é¡¯ç¤ºé»æ“Šåé¥‹
    piScriptBtn.BackgroundColor3 = Color3.fromRGB(255, 200, 0)
    piScriptBtn.Text = "ğŸ…¿ï¸ åŠ è¼‰ä¸­..."
    
    -- åŸ·è¡Œçš®è…³æœ¬
    local success = executePiScript()
    
    -- æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
    if success then
        piScriptBtn.BackgroundColor3 = Color3.fromRGB(60, 220, 60)
        piScriptBtn.Text = "ğŸ…¿ï¸ åŠ è¼‰æˆåŠŸ"
        task.wait(1.5)
        piScriptBtn.BackgroundColor3 = Color3.fromRGB(220, 150, 50)
        piScriptBtn.Text = "ğŸ…¿ï¸ çš®è…³æœ¬"
    else
        piScriptBtn.BackgroundColor3 = Color3.fromRGB(220, 60, 60)
        piScriptBtn.Text = "ğŸ…¿ï¸ åŠ è¼‰å¤±æ•—"
        task.wait(1.5)
        piScriptBtn.BackgroundColor3 = Color3.fromRGB(220, 150, 50)
        piScriptBtn.Text = "ğŸ…¿ï¸ çš®è…³æœ¬"
    end
end)

-- é—œé–‰æŒ‰éˆ•ï¼ˆä¿æŒä¸è®Šï¼‰
closeButton.MouseButton1Click:Connect(function()
    print("ğŸ”˜ é—œé–‰æŒ‰éˆ•è¢«é»æ“Š")
    
    -- åœæ­¢æ”»æ“Šç©å®¶
    if isAttackPlayersOn and attackPlayersModule and attackPlayersModule.stop then
        attackPlayersModule.stop()
    end
    
    -- åœæ­¢æ”»æ“ŠNPC
    if isAttackNPCOn and attackNPCModule and attackNPCModule.stop then
        attackNPCModule.stop()
    end
    
    -- é¡¯ç¤ºé—œé–‰å‹•ç•«
    closeButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
    closeButton.Text = "é—œé–‰ä¸­..."
    
    showNotification("ğŸ›‘ æ­£åœ¨é—œé–‰è…³æœ¬...", Color3.fromRGB(220, 60, 60), 1)
    
    task.wait(0.8)
    
    -- é—œé–‰UI
    if screenGui then
        screenGui:Destroy()
    end
    
    showNotification("âœ… è…³æœ¬å·²é—œé–‰", Color3.fromRGB(0, 180, 0), 1)
end)

-- ESCéµé—œé–‰ï¼ˆåƒ…é›»è…¦ï¼‰
if not isMobile then
    inputService.InputBegan:Connect(function(input, gameProcessed)
        if not gameProcessed and input.KeyCode == Enum.KeyCode.Escape then
            closeButton:Click()
        end
    end)
end

-- ========================
-- åˆå§‹åŒ–å®Œæˆ
-- ========================
task.wait(0.5)

-- é¡¯ç¤ºå•Ÿå‹•é€šçŸ¥
showNotification("âœ… eeeè…³æœ¬å·²åŠ è¼‰\nğŸ‘‘ eeeå‰µä½œ\nè¨­å‚™: " .. deviceType .. "\næ”»æ“Šç¯„åœ: 6000 å–®ä½\nç›®æ¨™: ç©å®¶+NPC\nä¸ç§»å‹•ä½ç½®", Color3.fromRGB(50, 150, 200), 3)

print("ğŸ® =================================")
print("ğŸ® eeeè…³æœ¬ - æ”»æ“Šç©å®¶èˆ‡NPCç‰ˆ v3.1")
print("ğŸ® å‰µä½œ: eee")
print("ğŸ® è¨­å‚™: " .. deviceType)
print("ğŸ® æ‹–å‹•åŠŸèƒ½: âœ… å·²å•Ÿç”¨")
print("ğŸ® æ”»æ“Šç©å®¶: " .. (isAttackPlayersOn and "é–‹å•Ÿ" or "é—œé–‰"))
print("ğŸ® æ”»æ“ŠNPC: " .. (isAttackNPCOn and "é–‹å•Ÿ" or "é—œé–‰"))
print("ğŸ® æ”»æ“Šç¯„åœ: 6000 å–®ä½")
print("ğŸ® æ”»æ“Šç›®æ¨™: ç©å®¶ + NPC/æ•µäºº")
print("ğŸ® ç§»å‹•ä½ç½®: âŒ å·²ç¦ç”¨")
print("ğŸ® çš®è…³æœ¬: å¯ç”¨")
print("ğŸ® =================================")

-- æ·»åŠ ç°¡å–®çš„å¹«åŠ©ä¿¡æ¯
task.spawn(function()
    task.wait(2)
    print("ğŸ’¡ ä½¿ç”¨å¹«åŠ©:")
    print("ğŸ’¡ 1. æ‹–å‹•: é»æ“Šæ¨™é¡Œæ¬„è—è‰²å€åŸŸ")
    print("ğŸ’¡ 2. æ”»æ“Šç©å®¶: é»æ“Šè—è‰²æŒ‰éˆ•é–‹é—œ")
    print("ğŸ’¡ 3. æ”»æ“ŠNPC: é»æ“Šç´«è‰²æŒ‰éˆ•é–‹é—œ")
    print("ğŸ’¡ 4. æ”»æ“Šç¯„åœ: 6000 å–®ä½")
    print("ğŸ’¡ 5. æ”»æ“Šç›®æ¨™: ç©å®¶æˆ–NPC/æ•µäºº")
    print("ğŸ’¡ 6. ç§»å‹•ä½ç½®: å·²ç¦ç”¨")
    print("ğŸ’¡ 7. çš®è…³æœ¬: é»æ“Šæ©™è‰²æŒ‰éˆ•åŠ è¼‰")
    print("ğŸ’¡ 8. é—œé–‰: é»æ“Š âœ• æˆ–æŒ‰ ESC")
end)

-- ç¢ºä¿æŒ‰éˆ•æ­£å¸¸å·¥ä½œçš„æœ€çµ‚æª¢æŸ¥
task.spawn(function()
    task.wait(1)
    
    local function testButtonClickable(button, name)
        if button and button:IsA("TextButton") then
            local connection = button.MouseButton1Click:Connect(function()
                print("âœ… " .. name .. " æŒ‰éˆ•é»æ“Šæ¸¬è©¦æˆåŠŸ")
                connection:Disconnect()
            end)
            
            -- æ¨¡æ“¬é»æ“Šï¼ˆåƒ…æ¸¬è©¦ï¼‰
            task.spawn(function()
                task.wait(0.1)
                if connection.Connected then
                    connection:Disconnect()
                end
            end)
            
            return true
        end
        return false
    end
    
    -- æ¸¬è©¦æ‰€æœ‰æŒ‰éˆ•
    local attackPlayersOk = testButtonClickable(attackPlayersBtn, "æ”»æ“Šç©å®¶")
    local attackNPCOk = testButtonClickable(attackNPCBtn, "æ”»æ“ŠNPC")
    local piScriptOk = testButtonClickable(piScriptBtn, "çš®è…³æœ¬")
    local closeOk = testButtonClickable(closeButton, "é—œé–‰")
    
    if attackPlayersOk and attackNPCOk and piScriptOk and closeOk then
        print("âœ… æ‰€æœ‰æŒ‰éˆ•åŠŸèƒ½æ­£å¸¸")
    else
        print("âš ï¸ éƒ¨åˆ†æŒ‰éˆ•å¯èƒ½æœ‰å•é¡Œ")
    end
end)

print("ğŸš€ eeeè…³æœ¬æ”»æ“Šç©å®¶èˆ‡NPCç‰ˆå®Œæˆï¼æ”»æ“Šç¯„åœ: 6000 å–®ä½ï¼Œç›®æ¨™: ç©å®¶+NPCï¼Œä¸ç§»å‹•ä½ç½®ã€‚")
